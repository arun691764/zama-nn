<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Zama Demo Testnet — FINAL</title>
<style>
:root{ --accent:#ffd400; --muted:#9aa6b2; --bg1:#00111a; --bg2:#041827; }
*{box-sizing:border-box;font-family:Inter,Arial,Helvetica,sans-serif;margin:0;padding:0;color:#e6eef6}
body{background:linear-gradient(180deg,var(--bg1),var(--bg2));min-height:100vh}
.topbar{display:flex;justify-content:space-between;align-items:center;padding:14px 20px;background:rgba(255,255,255,0.03);border-bottom:1px solid rgba(255,255,255,0.04)}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:56px;height:56px;border-radius:10px;object-fit:cover;border:2px solid rgba(0,0,0,0.25)}
.small{color:var(--muted);font-size:13px}
.container{max-width:1100px;margin:22px auto;display:flex;gap:18px;padding:10px}
.left{flex:1;display:flex;flex-direction:column;gap:14px}
.right{width:360px;display:flex;flex-direction:column;gap:14px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.btn{background:var(--accent);color:#061320;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
.area{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.logbox{background:#020617;padding:10px;border-radius:8px;color:#bfe7ff;overflow:auto;height:220px;white-space:pre-wrap}
.center{display:flex;align-items:center;justify-content:center;flex-direction:column}
.modal-backdrop{position:fixed;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.65), rgba(0,0,0,0.6));display:flex;align-items:center;justify-content:center;z-index:200}
.modal{background:linear-gradient(180deg,#071827,#0b2740);padding:26px;border-radius:16px;max-width:720px;display:flex;gap:20px;align-items:center;border:2px solid rgba(255,255,255,0.03)}
.modal img{width:130px;height:130px;border-radius:12px;object-fit:cover;border:3px solid rgba(255,255,255,0.04)}
.modal h2{margin:0 0 6px 0}
.modal p{margin:0;color:var(--muted)}
@media(max-width:900px){.container{flex-direction:column;padding:12px}.right{width:100%}.modal{flex-direction:column;text-align:center}}
</style>
</head>
<body>

<!-- WELCOME -->
<div id="welcome" class="modal-backdrop" aria-modal="true" role="dialog">
  <div class="modal" role="document">
    <img id="welcomeLogo" src="logo.png" alt="logo">
    <div style="flex:1">
      <h2>Welcome to the Zama Demo Testnet</h2>
      <p class="small" style="margin-top:6px">This is a simulated demo — wallet connect, faucet (one claim), swap flows and logs. No real blockchain calls.</p>
      <div style="display:flex;gap:10px;margin-top:14px">
        <button id="startBtn" class="btn">Start Demo</button>
        <button id="skipBtn" class="btn ghost">Skip</button>
      </div>
      <div class="small" style="margin-top:10px">Project: <a href="https://docs.zama.org/protocol" target="_blank" style="color:#9ae6b4">Zama Protocol</a> • Created by @AmitKum955</div>
    </div>
  </div>
</div>

<!-- TOPBAR -->
<header class="topbar">
  <div class="brand">
    <img id="topLogo" src="logo.png" class="logo" alt="logo">
    <div>
      <div style="font-weight:700">Zama Demo Testnet</div>
      <div class="small">Simulated demo — no real funds</div>
    </div>
  </div>
  <div style="display:flex;gap:12px;align-items:center">
    <div class="small" id="netBadge">Network: zama-demo (Chain 9999)</div>
    <button id="connectBtn" class="btn">Connect Wallet</button>
  </div>
</header>

<main class="container" aria-live="polite">
  <section class="left">
    <div class="card">
      <h3>Wallet & Faucet</h3>
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Address</div>
          <div id="walletAddr">Not connected</div>
        </div>
        <div>
          <div class="small">Balances</div>
          <div id="balances">tZAMA: 0 • tUSDC: 0</div>
        </div>
      </div>

      <div style="margin-top:12px">
        <label class="small">Name or Email (required to claim faucet once)</label>
        <input id="claimId" class="area" placeholder="name or email">
      </div>

      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="faucetZ" class="btn">Claim 100 tZAMA</button>
        <button id="faucetU" class="btn ghost">Claim 100 tUSDC</button>
      </div>
      <div class="small" style="margin-top:8px">Faucet: one claim per wallet OR per name/email — stored in your browser (demo).</div>
    </div>

    <div class="card">
      <h3>Swap</h3>
      <div style="display:flex;gap:8px;align-items:center;margin-top:10px" class="swap-form">
        <select id="fromToken" class="area" style="width:120px">
          <option value="ZAMA">tZAMA</option>
          <option value="USDC">tUSDC</option>
        </select>

        <select id="toToken" class="area" style="width:120px">
          <option value="USDC">tUSDC</option>
          <option value="ZAMA">tZAMA</option>
        </select>

        <input id="amount" type="number" class="area" placeholder="Amount" style="width:120px">
        <button id="swapBtn" class="btn">Swap</button>
      </div>

      <p class="small" style="margin-top:8px">Exchange rate: <span id="rateDisplay">1 tZAMA = 1.2 tUSDC</span></p>
      <p class="small">Swaps done (this wallet): <span id="swapCount">0</span></p>
      <div style="margin-top:8px">
        <label class="small"><input type="checkbox" id="shareApr"> Share APR on X after swap</label>
      </div>
    </div>
  </section>

  <aside class="right">
    <div class="card">
      <h3>MPC Nodes</h3>
      <div id="nodes" class="small">Loading nodes...</div>
      <div style="margin-top:8px"><button id="refreshNodes" class="btn ghost">Refresh</button></div>
    </div>

    <div class="card">
      <h3>Transactions / Logs</h3>
      <div id="lastTx" class="small">Last TX: -</div>
      <pre id="logs" class="logbox">No logs yet.</pre>
      <div style="margin-top:8px"><button id="clearBtn" class="btn ghost">Clear</button></div>
    </div>

    <div class="card center">
      <div class="small">Block Height</div>
      <div id="blockHeight" style="font-size:20px;font-weight:700">120000</div>
      <div class="small" style="margin-top:6px">Chain: zama-demo</div>
    </div>
  </aside>
</main>

<div style="text-align:center;color:var(--muted);padding:12px 0">Demo based on <a href="https://docs.zama.org/protocol" target="_blank" style="color:#9ae6b4">Zama docs</a> • Created by @AmitKum955</div>

<script>
/* ---------- Demo logic: stable, no errors, safe to paste as index.html ---------- */

const connectBtn = document.getElementById('connectBtn');
const walletAddr = document.getElementById('walletAddr');
const balancesEl = document.getElementById('balances');
const faucetZ = document.getElementById('faucetZ');
const faucetU = document.getElementById('faucetU');
const claimId = document.getElementById('claimId');

const fromToken = document.getElementById('fromToken');
const toToken = document.getElementById('toToken');
const amountInput = document.getElementById('amount');
const swapBtn = document.getElementById('swapBtn');
const rateDisplay = document.getElementById('rateDisplay');
const swapCountEl = document.getElementById('swapCount');
const shareApr = document.getElementById('shareApr');

const nodesEl = document.getElementById('nodes');
const refreshNodes = document.getElementById('refreshNodes');

const logs = document.getElementById('logs');
const lastTx = document.getElementById('lastTx');
const clearBtn = document.getElementById('clearBtn');

const welcome = document.getElementById('welcome');
const startBtn = document.getElementById('startBtn');
const skipBtn = document.getElementById('skipBtn');

const blockHeightEl = document.getElementById('blockHeight');

let state = {
  wallet: null,
  balances: { ZAMA: 0, USDC: 0 },
  logs: [],
  swapCount: 0,
  rate: 1.2,
  blockHeight: 120000
};

/* UTIL: log event to state & UI */
function pushEvent(ev){
  ev.time = new Date().toLocaleTimeString();
  state.logs.unshift(ev);
  if(state.logs.length > 200) state.logs.pop();
  renderLogs();
}

/* update UI from state */
function renderLogs(){
  logs.textContent = state.logs.map(l => JSON.stringify(l, null, 2)).join("\n\n");
  balancesEl.textContent = `tZAMA: ${state.balances.ZAMA} • tUSDC: ${state.balances.USDC}`;
  swapCountEl.textContent = getSwapCount();
  const lastConfirmed = state.logs.find(e => e.event === 'tx_confirmed' || e.event==='swap');
  lastTx.textContent = lastConfirmed ? ('Last TX: '+ (lastConfirmed.tx || lastConfirmed.id || '-')) : 'Last TX: -';
}

/* localStorage keys helpers */
function keyBalances(addr){ return `demo_balances_${addr}`; }
function keyClaimWallet(addr){ return `demo_claim_wallet_${addr}`; }
function keyClaimId(id){ return `demo_claim_id_${id}`; }
function keySwapCount(addr){ return `demo_swap_count_${addr}`; }

/* swap count */
function getSwapCount(){
  if(!state.wallet) return 0;
  return parseInt(localStorage.getItem(keySwapCount(state.wallet)) || '0', 10);
}
function incrementSwapCount(){
  if(!state.wallet) return;
  const k = keySwapCount(state.wallet);
  const v = parseInt(localStorage.getItem(k) || '0', 10) + 1;
  localStorage.setItem(k, String(v));
}

/* wallet connect (fake) */
connectBtn.addEventListener('click', () => {
  if(!state.wallet){
    state.wallet = '0x' + Math.random().toString(16).slice(2,14);
    walletAddr.textContent = state.wallet;
    connectBtn.textContent = 'Disconnect';
    pushEvent({ event: 'wallet_connected', address: state.wallet });
    // load balances if stored
    const b = localStorage.getItem(keyBalances(state.wallet));
    if(b) state.balances = JSON.parse(b);
    renderLogs();
  } else {
    pushEvent({ event: 'wallet_disconnected', address: state.wallet });
    state.wallet = null;
    walletAddr.textContent = 'Not connected';
    connectBtn.textContent = 'Connect Wallet';
    renderLogs();
  }
});

/* Faucet: once per wallet OR once per name/email */
function canClaimByWallet(addr){
  return !localStorage.getItem(keyClaimWallet(addr));
}
function canClaimById(id){
  return !localStorage.getItem(keyClaimId(id));
}
function markClaimWallet(addr){
  localStorage.setItem(keyClaimWallet(addr), JSON.stringify({time: new Date().toISOString()}));
}
function markClaimId(id){
  localStorage.setItem(keyClaimId(id), JSON.stringify({time: new Date().toISOString()}));
}

faucetZ.addEventListener('click', () => {
  const id = (claimId.value || '').trim();
  if(!state.wallet && !id){ alert('Connect wallet or enter name/email to claim'); return; }
  if(state.wallet && !canClaimByWallet(state.wallet)){ alert('This wallet already claimed faucet once'); return; }
  if(id && !canClaimById(id)){ alert('This name/email already claimed faucet once'); return; }
  state.balances.ZAMA = Math.round((state.balances.ZAMA + 100) * 10000) / 10000;
  pushEvent({ event: 'faucet', token: 'tZAMA', amount: 100, by: state.wallet || id });
  if(state.wallet) markClaimWallet(state.wallet);
  if(id) markClaimId(id);
  if(state.wallet) localStorage.setItem(keyBalances(state.wallet), JSON.stringify(state.balances));
  renderLogs();
});

faucetU.addEventListener('click', () => {
  const id = (claimId.value || '').trim();
  if(!state.wallet && !id){ alert('Connect wallet or enter name/email to claim'); return; }
  if(state.wallet && !canClaimByWallet(state.wallet)){ alert('This wallet already claimed faucet once'); return; }
  if(id && !canClaimById(id)){ alert('This name/email already claimed faucet once'); return; }
  state.balances.USDC = Math.round((state.balances.USDC + 100) * 10000) / 10000;
  pushEvent({ event: 'faucet', token: 'tUSDC', amount: 100, by: state.wallet || id });
  if(state.wallet) markClaimWallet(state.wallet);
  if(id) markClaimId(id);
  if(state.wallet) localStorage.setItem(keyBalances(state.wallet), JSON.stringify(state.balances));
  renderLogs();
});

/* Swap logic: selectable tokens, fee 0.5% */
swapBtn.addEventListener('click', () => {
  if(!state.wallet){ alert('Connect wallet first'); return; }
  const from = fromToken.value;
  const to = toToken.value;
  if(from === to){ alert('Choose different tokens'); return; }
  const amount = parseFloat(amountInput.value);
  if(!amount || amount <= 0){ alert('Enter valid amount'); return; }
  const inToken = (from === 'ZAMA') ? 'ZAMA' : 'USDC';
  const outToken = (to === 'ZAMA') ? 'ZAMA' : 'USDC';
  if(state.balances[inToken] < amount){ alert('Insufficient balance'); return; }
  const feePct = 0.005;
  let received;
  if(inToken === 'ZAMA'){
    received = amount * state.rate * (1 - feePct);
  } else {
    received = (amount / state.rate) * (1 - feePct);
  }
  received = Math.round(received * 10000) / 10000;
  state.balances[inToken] = Math.round((state.balances[inToken] - amount) * 10000) / 10000;
  state.balances[outToken] = Math.round((state.balances[outToken] + received) * 10000) / 10000;
  const tx = '0x' + Math.random().toString(16).slice(2,14);
  pushEvent({ event: 'swap', from: inToken, to: outToken, amount: amount, received: received, tx: tx });
  incrementSwapCount();
  if(state.wallet) localStorage.setItem(keyBalances(state.wallet), JSON.stringify(state.balances));
  renderLogs();
  // share APR on X if selected
  if(shareApr.checked){
    const apr = 'APR: 12.5%';
    const text = encodeURIComponent(`Tried the Zama Demo Testnet! Swapped ${amount} ${inToken} → ${received} ${outToken}. ${apr} Learn more: https://docs.zama.org/protocol Created by @AmitKum955`);
    window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
  }
  alert(`Swapped ${amount} ${inToken} → ${received} ${outToken} (tx ${tx})`);
});

/* nodes simulation */
function renderNodes(){
  const parts = [];
  for(let i=1;i<=5;i++){
    const on = Math.random() > 0.08;
    parts.push(`Node ${i}: ${on ? 'ONLINE' : 'OFFLINE'}`);
  }
  nodesEl.textContent = parts.join('\n');
  pushEvent({ event: 'nodes_refreshed', nodes: parts });
}
refreshNodes.addEventListener('click', renderNodes);

/* block height incrementer */
setInterval(() => {
  state.blockHeight += Math.floor(Math.random() * 3);
  blockHeightEl.textContent = state.blockHeight;
}, 1500);

/* clear logs */
clearBtn.addEventListener('click', () => {
  state.logs = [];
  renderLogs();
  pushEvent({ event: 'logs_cleared' });
});

/* welcome controls */
startBtn.addEventListener('click', () => {
  welcome.style.display = 'none';
  pushEvent({ event: 'demo_started' });
});
skipBtn.addEventListener('click', () => {
  welcome.style.display = 'none';
  pushEvent({ event: 'demo_skipped' });
});

/* initial render */
renderNodes();
renderLogs();
pushEvent({ event: 'demo_loaded' });

/* keyboard: W toggles welcome */
document.addEventListener('keydown', (e) => {
  if(e.key && e.key.toLowerCase() === 'w'){
    welcome.style.display = (welcome.style.display === 'none') ? 'flex' : 'none';
  }
});
</script>
</body>
</html>
